

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Quantum Key Distribution &mdash; QuNetSim  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Quantum Coin Flipping" href="quantum_coin_flipping.html" />
    <link rel="prev" title="Routing with Entanglement" href="entanglement_routing.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> QuNetSim
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#what-is-qunetsim">What is QuNetSim?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#who-should-use-qunetsim">Who should use QuNetSim?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#via-pip">Via pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#linux-mac-os-x">Linux / Mac OS X</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#windows">Windows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start Guide</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../design.html">Design Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../components.html">Network Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/host.html">Host</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/network.html">Network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/protocols.html">Protocols</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../objects.html">Network Objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../objects/classical_storage.html">Classical Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../objects/message.html">Message</a></li>
<li class="toctree-l3"><a class="reference internal" href="../objects/packet.html">Packet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../objects/quantum_storage.html">Quantum Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../objects/qubit.html">Qubit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../objects/routing_packet.html">Routing Packet</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../backends.html">Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backends.html#writing-your-own-backend">Writing your own Backend</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="send_data.html">Send Data Qubits</a></li>
<li class="toctree-l2"><a class="reference internal" href="send_epr.html">Send EPR Pairs</a></li>
<li class="toctree-l2"><a class="reference internal" href="chsh.html">CHSH Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet_sniffing.html">Eavesdropping on channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="quantum_money.html">Quantum Money with a Man-in-the-Middle Attack</a></li>
<li class="toctree-l2"><a class="reference internal" href="entanglement_routing.html">Routing with Entanglement</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Quantum Key Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="quantum_coin_flipping.html">Quantum Coin Flipping</a></li>
<li class="toctree-l2"><a class="reference internal" href="anonymous_transfer.html">GHZ Based Anonymous Entanglement</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QuNetSim</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../examples.html">Examples</a> &raquo;</li>
        
      <li>Quantum Key Distribution</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/examples/QKD.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quantum-key-distribution">
<h1>Quantum Key Distribution<a class="headerlink" href="#quantum-key-distribution" title="Permalink to this headline">¶</a></h1>
<p>In this example, we’ll see how the Quantum Key Distribution algorithm can be
implemented using QuNetSim. First, we create a network of three different parties:
Alice, Bob, and Eve. In the topology of the network, Alice can talk to Bob and Bob
can talk to Eve.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c1"># Initialize a network</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">Network</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>

<span class="c1"># Define the host IDs in the network</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;Eve&#39;</span><span class="p">]</span>

<span class="c1"># Start the network with the defined hosts</span>
<span class="n">network</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>

<span class="c1"># Initialize the host Alice</span>
<span class="n">host_alice</span> <span class="o">=</span> <span class="n">Host</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">)</span>

<span class="c1"># Add a one-way connection (classical and quantum) to Bob</span>
<span class="n">host_alice</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">)</span>

<span class="c1"># Start listening</span>
<span class="n">host_alice</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="n">host_bob</span> <span class="o">=</span> <span class="n">Host</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">)</span>
<span class="c1"># Bob adds his own one-way connection to Alice and Eve</span>
<span class="n">host_bob</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">)</span>
<span class="n">host_bob</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="s1">&#39;Eve&#39;</span><span class="p">)</span>
<span class="n">host_bob</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="n">host_eve</span> <span class="o">=</span> <span class="n">Host</span><span class="p">(</span><span class="s1">&#39;Eve&#39;</span><span class="p">)</span>
<span class="n">host_eve</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">)</span>
<span class="n">host_eve</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># Add the hosts to the network</span>
<span class="c1"># The network is: Alice &lt;--&gt; Bob &lt;--&gt; Eve</span>
<span class="n">network</span><span class="o">.</span><span class="n">add_host</span><span class="p">(</span><span class="n">host_alice</span><span class="p">)</span>
<span class="n">network</span><span class="o">.</span><span class="n">add_host</span><span class="p">(</span><span class="n">host_bob</span><span class="p">)</span>
<span class="n">network</span><span class="o">.</span><span class="n">add_host</span><span class="p">(</span><span class="n">host_eve</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Alice now wants to communicate securely to Eve, without Bob beeing able to read
their communication. To do so, Alice and Eve first want to share a secret key.
Once they have the key, they can use a pre shared key protocol, such as AES
(see <a class="reference external" href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">here</a>)
to communicate securely with each other. However, sharing the key is not trivial.
The QKD algorithm solves this problem. If you are not familiar with it yet,
see <a class="reference external" href="https://en.wikipedia.org/wiki/BB84">here</a>.</p>
<p>First, Alice has to create a random key which she can then share with Eve.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">key_size</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># the size of the key in bit</span>
<span class="n">secret_key</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">key_size</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>We now implement the protocols used by Alice and Eve.
Alice randomly decides in which basis she sends her bits. She either chooses
the |0&gt; |1&gt; basis or the |+&gt; |-&gt; basis. Eve also chooses a random basis in which
she measures the qubit. She then sends a classical message to Alice, in which basis
she has measured her qubit. Alice then checks if the basis have matched and sends the result
to Eve. If they have matched, she continues with the next bit. Otherwise, she repeats
the same bit again, until the transmission works.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">alice_qkd</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">,</span> <span class="n">receiver</span><span class="p">):</span>
    <span class="n">sequence_nr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># iterate over all bits in the secret key.</span>
    <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">secret_key</span><span class="p">:</span>
        <span class="n">ack</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">ack</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Alice sent </span><span class="si">%d</span><span class="s2"> key bits&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sequence_nr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="c1"># get a random base. 0 for Z base and 1 for X base.</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># create qubit</span>
            <span class="n">q_bit</span> <span class="o">=</span> <span class="n">Qubit</span><span class="p">(</span><span class="n">alice</span><span class="p">)</span>

            <span class="c1"># Set qubit to the bit from the secret key.</span>
            <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">q_bit</span><span class="o">.</span><span class="n">X</span><span class="p">()</span>

            <span class="c1"># Apply basis change to the bit if necessary.</span>
            <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">q_bit</span><span class="o">.</span><span class="n">H</span><span class="p">()</span>

            <span class="c1"># Send Qubit to Bob</span>
            <span class="n">alice</span><span class="o">.</span><span class="n">send_qubit</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">q_bit</span><span class="p">,</span> <span class="n">await_ack</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

            <span class="c1"># Get measured basis of Bob</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">alice</span><span class="o">.</span><span class="n">get_next_classical_message</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">sequence_nr</span><span class="p">)</span>

            <span class="c1"># Compare to send basis, if same, answer with 0 and set ack True and go to next bit,</span>
            <span class="c1"># otherwise, send 1 and repeat.</span>
            <span class="k">if</span> <span class="n">message</span> <span class="o">==</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">sequence_nr</span><span class="p">,</span> <span class="n">base</span><span class="p">):</span>
                <span class="n">ack</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">alice</span><span class="o">.</span><span class="n">send_classical</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">:0&quot;</span> <span class="o">%</span> <span class="n">sequence_nr</span><span class="p">),</span> <span class="n">await_ack</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ack</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">alice</span><span class="o">.</span><span class="n">send_classical</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">:1&quot;</span> <span class="o">%</span> <span class="n">sequence_nr</span><span class="p">),</span> <span class="n">await_ack</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

            <span class="n">sequence_nr</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">eve_qkd</span><span class="p">(</span><span class="n">eve</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">key_size</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
    <span class="n">sequence_nr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">received_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">key_array</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">while</span> <span class="n">received_counter</span> <span class="o">&lt;</span> <span class="n">key_size</span><span class="p">:</span>
        <span class="c1"># decide for a measurement base</span>
        <span class="n">measurement_base</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># wait for the qubit</span>
        <span class="n">q_bit</span> <span class="o">=</span> <span class="n">eve</span><span class="o">.</span><span class="n">get_data_qubit</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="n">wait_time</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">q_bit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">q_bit</span> <span class="o">=</span> <span class="n">eve</span><span class="o">.</span><span class="n">get_data_qubit</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="n">wait_time</span><span class="p">)</span>

        <span class="c1"># measure qubit in right measurement basis</span>
        <span class="k">if</span> <span class="n">measurement_base</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">q_bit</span><span class="o">.</span><span class="n">H</span><span class="p">()</span>
        <span class="n">bit</span> <span class="o">=</span> <span class="n">q_bit</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span>

        <span class="c1"># Send Alice the base in which Bob has measured</span>
        <span class="n">eve</span><span class="o">.</span><span class="n">send_classical</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sequence_nr</span><span class="p">,</span> <span class="n">measurement_base</span><span class="p">),</span> <span class="n">await_ack</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># get the return message from Alice, to know if the bases have matched</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">eve</span><span class="o">.</span><span class="n">get_next_classical_message</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">sequence_nr</span><span class="p">)</span>

        <span class="c1"># Check if the bases have matched</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="o">==</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">:0&quot;</span> <span class="o">%</span> <span class="n">sequence_nr</span><span class="p">):</span>
            <span class="n">received_counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Eve received </span><span class="si">%d</span><span class="s2"> key bits.&quot;</span> <span class="o">%</span> <span class="n">received_counter</span><span class="p">)</span>
            <span class="n">key_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bit</span><span class="p">)</span>
        <span class="n">sequence_nr</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">key_array</span>
</pre></div>
</td></tr></table></div>
<p>In the end, Alice and Eve should have the same key. What they still need are an
encryption and decryption function to encrypt and decrypt their messages. Because
our key is too small to use a real encryption function, we will define our own one:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># !! Warning: this Crypto algorithm is really bad!</span>
<span class="c1"># !! Warning: Do not use it as a real Crypto Algorithm!</span>

<span class="c1"># key has to be a string</span>
<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="n">encrypted_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">encrypted_text</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">^</span><span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">encrypted_text</span>

<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">encrypted_text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">encrypted_text</span><span class="p">)</span>

<span class="c1"># Test the encryption algorithm</span>
<span class="k">print</span><span class="p">(</span><span class="n">decrypt</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">decrypt</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s2">&quot;Encryption works!&quot;</span><span class="p">)))</span>
</pre></div>
</td></tr></table></div>
<p>Alice can finally send her message to Eve, without being disturbed by Bob!</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># helper function, used to make the key to a string</span>
<span class="k">def</span> <span class="nf">key_array_to_key_string</span><span class="p">(</span><span class="n">key_array</span><span class="p">):</span>
    <span class="n">key_string_binary</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">key_array</span><span class="p">])</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">key_string_binary</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">8</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">alice_send_message</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">,</span> <span class="n">receiver</span><span class="p">):</span>
    <span class="n">msg_to_eve</span> <span class="o">=</span> <span class="s2">&quot;Hi Eve, how are you???&quot;</span>
    <span class="n">secret_key_string</span> <span class="o">=</span> <span class="n">key_array_to_key_string</span><span class="p">(</span><span class="n">secret_key</span><span class="p">)</span>
    <span class="n">encrypted_msg_to_eve</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">secret_key_string</span><span class="p">,</span> <span class="n">msg_to_eve</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Alice sends encrypted message&quot;</span><span class="p">)</span>
    <span class="n">alice</span><span class="o">.</span><span class="n">send_classical</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s2">&quot;-1:&quot;</span> <span class="o">+</span> <span class="n">encrypted_msg_to_eve</span><span class="p">,</span> <span class="n">await_ack</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">eve_receive_message</span><span class="p">(</span><span class="n">eve</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">eve_key</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
    <span class="n">encrypted_msg_from_alice</span> <span class="o">=</span> <span class="n">eve</span><span class="o">.</span><span class="n">get_next_classical_message</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">encrypted_msg_from_alice</span> <span class="o">=</span> <span class="n">encrypted_msg_from_alice</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">secret_key_string</span> <span class="o">=</span> <span class="n">key_array_to_key_string</span><span class="p">(</span><span class="n">eve_key</span><span class="p">)</span>
    <span class="n">decrypted_msg_from_alice</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">secret_key_string</span><span class="p">,</span> <span class="n">encrypted_msg_from_alice</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Eve received decoded message: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">decrypted_msg_from_alice</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>We can now concatenate the two actions of Alice and Eve and let them each run in their own thread.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Concatentate functions</span>
<span class="k">def</span> <span class="nf">alice_func</span><span class="p">(</span><span class="n">alice</span><span class="p">):</span>
    <span class="n">msg_buff</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">alice_qkd</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">,</span> <span class="n">host_eve</span><span class="o">.</span><span class="n">host_id</span><span class="p">)</span>
    <span class="n">alice_send_message</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">,</span> <span class="n">host_eve</span><span class="o">.</span><span class="n">host_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">eve_func</span><span class="p">(</span><span class="n">eve</span><span class="p">):</span>
    <span class="n">msg_buff</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">eve_key</span> <span class="o">=</span> <span class="n">eve_qkd</span><span class="p">(</span><span class="n">eve</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">key_size</span><span class="p">,</span> <span class="n">host_alice</span><span class="o">.</span><span class="n">host_id</span><span class="p">)</span>
    <span class="n">eve_receive_message</span><span class="p">(</span><span class="n">eve</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">eve_key</span><span class="p">,</span> <span class="n">host_alice</span><span class="o">.</span><span class="n">host_id</span><span class="p">)</span>

<span class="c1"># Run Bob and Alice</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">host_alice</span><span class="o">.</span><span class="n">run_protocol</span><span class="p">(</span><span class="n">alice_func</span><span class="p">,</span> <span class="p">())</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">host_eve</span><span class="o">.</span><span class="n">run_protocol</span><span class="p">(</span><span class="n">eve_func</span><span class="p">,</span> <span class="p">())</span>

<span class="n">t1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="n">t2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>The full example is below:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">components.host</span> <span class="kn">import</span> <span class="n">Host</span>
<span class="kn">from</span> <span class="nn">components.network</span> <span class="kn">import</span> <span class="n">Network</span>
<span class="kn">from</span> <span class="nn">objects.qubit</span> <span class="kn">import</span> <span class="n">Qubit</span>
<span class="kn">from</span> <span class="nn">components.logger</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="n">Logger</span><span class="o">.</span><span class="n">DISABLED</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">wait_time</span> <span class="o">=</span> <span class="mi">10</span>


<span class="c1"># !! Warning: this Crypto algorithm is really bad!</span>
<span class="c1"># !! Warning: Do not use it as a real Crypto Algorithm!</span>

<span class="c1"># key has to be a string</span>
<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">encrypted_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">encrypted_text</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">encrypted_text</span>


<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">encrypted_text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">encrypted_text</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">alice_qkd</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">,</span> <span class="n">receiver</span><span class="p">):</span>
    <span class="n">sequence_nr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># iterate over all bits in the secret key.</span>
    <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">secret_key</span><span class="p">:</span>
        <span class="n">ack</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">ack</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Alice sent </span><span class="si">%d</span><span class="s2"> key bits&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sequence_nr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="c1"># get a random base. 0 for Z base and 1 for X base.</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># create qubit</span>
            <span class="n">q_bit</span> <span class="o">=</span> <span class="n">Qubit</span><span class="p">(</span><span class="n">alice</span><span class="p">)</span>

            <span class="c1"># Set qubit to the bit from the secret key.</span>
            <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">q_bit</span><span class="o">.</span><span class="n">X</span><span class="p">()</span>

            <span class="c1"># Apply basis change to the bit if necessary.</span>
            <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">q_bit</span><span class="o">.</span><span class="n">H</span><span class="p">()</span>

            <span class="c1"># Send Qubit to Bob</span>
            <span class="n">alice</span><span class="o">.</span><span class="n">send_qubit</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">q_bit</span><span class="p">,</span> <span class="n">await_ack</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

            <span class="c1"># Get measured basis of Bob</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">alice</span><span class="o">.</span><span class="n">get_next_classical_message</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">sequence_nr</span><span class="p">)</span>

            <span class="c1"># Compare to send basis, if same, answer with 0 and set ack True and go to next bit,</span>
            <span class="c1"># otherwise, send 1 and repeat.</span>
            <span class="k">if</span> <span class="n">message</span> <span class="o">==</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">sequence_nr</span><span class="p">,</span> <span class="n">base</span><span class="p">):</span>
                <span class="n">ack</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">alice</span><span class="o">.</span><span class="n">send_classical</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">:0&quot;</span> <span class="o">%</span> <span class="n">sequence_nr</span><span class="p">),</span> <span class="n">await_ack</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ack</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">alice</span><span class="o">.</span><span class="n">send_classical</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">:1&quot;</span> <span class="o">%</span> <span class="n">sequence_nr</span><span class="p">),</span> <span class="n">await_ack</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

            <span class="n">sequence_nr</span> <span class="o">+=</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">eve_qkd</span><span class="p">(</span><span class="n">eve</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">key_size</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
    <span class="n">sequence_nr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">received_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">key_array</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">while</span> <span class="n">received_counter</span> <span class="o">&lt;</span> <span class="n">key_size</span><span class="p">:</span>
        <span class="c1"># decide for a measurement base</span>
        <span class="n">measurement_base</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># wait for the qubit</span>
        <span class="n">q_bit</span> <span class="o">=</span> <span class="n">eve</span><span class="o">.</span><span class="n">get_data_qubit</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="n">wait_time</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">q_bit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">q_bit</span> <span class="o">=</span> <span class="n">eve</span><span class="o">.</span><span class="n">get_data_qubit</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="n">wait_time</span><span class="p">)</span>

        <span class="c1"># measure qubit in right measurement basis</span>
        <span class="k">if</span> <span class="n">measurement_base</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">q_bit</span><span class="o">.</span><span class="n">H</span><span class="p">()</span>
        <span class="n">bit</span> <span class="o">=</span> <span class="n">q_bit</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span>

        <span class="c1"># Send Alice the base in which Bob has measured</span>
        <span class="n">eve</span><span class="o">.</span><span class="n">send_classical</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sequence_nr</span><span class="p">,</span> <span class="n">measurement_base</span><span class="p">),</span> <span class="n">await_ack</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># get the return message from Alice, to know if the bases have matched</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">eve</span><span class="o">.</span><span class="n">get_next_classical_message</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">sequence_nr</span><span class="p">)</span>

        <span class="c1"># Check if the bases have matched</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="o">==</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">:0&quot;</span> <span class="o">%</span> <span class="n">sequence_nr</span><span class="p">):</span>
            <span class="n">received_counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Eve received </span><span class="si">%d</span><span class="s2"> key bits.&quot;</span> <span class="o">%</span> <span class="n">received_counter</span><span class="p">)</span>
            <span class="n">key_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bit</span><span class="p">)</span>
        <span class="n">sequence_nr</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">eve_key</span> <span class="o">=</span> <span class="n">key_array</span>

    <span class="k">return</span> <span class="n">eve_key</span>


<span class="c1"># helper function, used to make the key to a string</span>
<span class="k">def</span> <span class="nf">key_array_to_key_string</span><span class="p">(</span><span class="n">key_array</span><span class="p">):</span>
    <span class="n">key_string_binary</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">key_array</span><span class="p">])</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">key_string_binary</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">8</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">alice_send_message</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">,</span> <span class="n">receiver</span><span class="p">):</span>
    <span class="n">msg_to_eve</span> <span class="o">=</span> <span class="s2">&quot;Hi Eve, how are you???&quot;</span>
    <span class="n">secret_key_string</span> <span class="o">=</span> <span class="n">key_array_to_key_string</span><span class="p">(</span><span class="n">secret_key</span><span class="p">)</span>
    <span class="n">encrypted_msg_to_eve</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">secret_key_string</span><span class="p">,</span> <span class="n">msg_to_eve</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Alice sends encrypted message&quot;</span><span class="p">)</span>
    <span class="n">alice</span><span class="o">.</span><span class="n">send_classical</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s2">&quot;-1:&quot;</span> <span class="o">+</span> <span class="n">encrypted_msg_to_eve</span><span class="p">,</span> <span class="n">await_ack</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">eve_receive_message</span><span class="p">(</span><span class="n">eve</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">eve_key</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
    <span class="n">encrypted_msg_from_alice</span> <span class="o">=</span> <span class="n">eve</span><span class="o">.</span><span class="n">get_next_classical_message</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">encrypted_msg_from_alice</span> <span class="o">=</span> <span class="n">encrypted_msg_from_alice</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">secret_key_string</span> <span class="o">=</span> <span class="n">key_array_to_key_string</span><span class="p">(</span><span class="n">eve_key</span><span class="p">)</span>
    <span class="n">decrypted_msg_from_alice</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">secret_key_string</span><span class="p">,</span> <span class="n">encrypted_msg_from_alice</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Eve received decoded message: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">decrypted_msg_from_alice</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Initialize a network</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">Network</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>

    <span class="c1"># Define the host IDs in the network</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;Eve&#39;</span><span class="p">]</span>

    <span class="n">network</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># Start the network with the defined hosts</span>
    <span class="n">network</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>

    <span class="c1"># Initialize the host Alice</span>
    <span class="n">host_alice</span> <span class="o">=</span> <span class="n">Host</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">)</span>

    <span class="c1"># Add a one-way connection (classical and quantum) to Bob</span>
    <span class="n">host_alice</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">)</span>

    <span class="c1"># Start listening</span>
    <span class="n">host_alice</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="n">host_bob</span> <span class="o">=</span> <span class="n">Host</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">)</span>
    <span class="c1"># Bob adds his own one-way connection to Alice and Eve</span>
    <span class="n">host_bob</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">)</span>
    <span class="n">host_bob</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="s1">&#39;Eve&#39;</span><span class="p">)</span>
    <span class="n">host_bob</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="n">host_eve</span> <span class="o">=</span> <span class="n">Host</span><span class="p">(</span><span class="s1">&#39;Eve&#39;</span><span class="p">)</span>
    <span class="n">host_eve</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">)</span>
    <span class="n">host_eve</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c1"># Add the hosts to the network</span>
    <span class="c1"># The network is: Alice &lt;--&gt; Bob &lt;--&gt; Eve</span>
    <span class="n">network</span><span class="o">.</span><span class="n">add_host</span><span class="p">(</span><span class="n">host_alice</span><span class="p">)</span>
    <span class="n">network</span><span class="o">.</span><span class="n">add_host</span><span class="p">(</span><span class="n">host_bob</span><span class="p">)</span>
    <span class="n">network</span><span class="o">.</span><span class="n">add_host</span><span class="p">(</span><span class="n">host_eve</span><span class="p">)</span>

    <span class="c1"># Generate random key</span>
    <span class="n">key_size</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># the size of the key in bit</span>
    <span class="n">secret_key</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">key_size</span><span class="p">)</span>

    <span class="c1"># Concatentate functions</span>
    <span class="k">def</span> <span class="nf">alice_func</span><span class="p">(</span><span class="n">alice</span><span class="p">):</span>
        <span class="n">msg_buff</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">alice_qkd</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">,</span> <span class="n">host_eve</span><span class="o">.</span><span class="n">host_id</span><span class="p">)</span>
        <span class="n">alice_send_message</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">,</span> <span class="n">host_eve</span><span class="o">.</span><span class="n">host_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">eve_func</span><span class="p">(</span><span class="n">eve</span><span class="p">):</span>
        <span class="n">msg_buff</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">eve_key</span> <span class="o">=</span> <span class="n">eve_qkd</span><span class="p">(</span><span class="n">eve</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">key_size</span><span class="p">,</span> <span class="n">host_alice</span><span class="o">.</span><span class="n">host_id</span><span class="p">)</span>
        <span class="n">eve_receive_message</span><span class="p">(</span><span class="n">eve</span><span class="p">,</span> <span class="n">msg_buff</span><span class="p">,</span> <span class="n">eve_key</span><span class="p">,</span> <span class="n">host_alice</span><span class="o">.</span><span class="n">host_id</span><span class="p">)</span>

    <span class="c1"># Run Bob and Alice</span>

    <span class="n">t1</span> <span class="o">=</span> <span class="n">host_alice</span><span class="o">.</span><span class="n">run_protocol</span><span class="p">(</span><span class="n">alice_func</span><span class="p">,</span> <span class="p">())</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">host_eve</span><span class="o">.</span><span class="n">run_protocol</span><span class="p">(</span><span class="n">eve_func</span><span class="p">,</span> <span class="p">())</span>

    <span class="n">t1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">t2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Stephen DiAdamo, Janis Nötzel

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>